#!/bin/bash
sudo yum update -y
sudo yum -y install epel-release
sudo yum install -y curl ca-certificates wget unzip git
sudo yum -y install python-pip
sudo yum -y install python3
curl -O https://bootstrap.pypa.io/get-pip.py
sudo python3 get-pip.py
sudo yum -y install awscli
sudo yum install -y yum-utils \
  device-mapper-persistent-data \
  lvm2
sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
sudo yum -y install docker-ce docker-ce-cli containerd.io
sleep 10
sudo systemctl start docker
sleep 10
sudo systemctl status docker
sudo curl https://releases.hashicorp.com/terraform/0.12.16/terraform_0.12.16_linux_amd64.zip -o terraform_0.12.16_linux_amd64.zip
sudo unzip terraform_0.12.16_linux_amd64.zip
sudo mv terraform /usr/local/bin/
sudo rm terraform_0.12.16_linux_amd64.zip
sudo wget -O rstudio-latest-x86_64.rpm https://www.rstudio.org/download/latest/stable/desktop/redhat64/rstudio-latest-x86_64.rpm
echo "Installing RStudio and R packages..."
sudo yum -y install --nogpgcheck rstudio-latest-x86_64.rpm
sudo yum -y install R
# Instaling RStudio Server on port 8787
echo "Installing RStudio Server which can be accessed via port 8787"
wget https://download2.rstudio.org/server/centos6/x86_64/rstudio-server-rhel-1.2.5019-x86_64.rpm
sudo yum -y install rstudio-server-rhel-1.2.5019-x86_64.rpm


# Install MATE Desktop Envrionment from EPEL for CentOS 7
# sudo yum -y groupinstall "MATE Desktop" "Graphical Administration Tools"

# Install GNOME Desktop Environment for CentOS 7
sudo yum -y groupinstall "GNOME Desktop" "Graphical Administration Tools"
sudo ln -sf /lib/systemd/system/runlevel5.target /etc/systemd/system/default.target

# Install TigerVNC
echo "Installing TigerVNC & xRDP..."
sudo yum -y install tigervnc-server xrdp

# Always starts xRDP at boot
echo "Linking xRDP Server service to start at boot..."
sudo systemctl enable xrdp.service
sudo systemctl stop firewalld
sudo systemctl disable firewalld

echo ""; sleep 1
echo "xRDP installation and configuration complete..."; sleep 2
echo ""
echo "Please create a password for xRDP Server user..."; sleep 2
echo ""
echo "Don't forget to open ports 3389 for RDP and 8787 for RStudio Server..."; sleep 2;  
echo ""
sudo wget https://dl.google.com/linux/linux_signing_key.pub
sudo rpm --import linux_signing_key.pub
sudo wget https://dl.google.com/linux/direct/google-chrome-stable_current_x86_64.rpm
sudo yum install -y ./google-chrome-stable_current_*.rpm
sleep 5
sudo rm ./google-chrome-stable_current_*.rpm
sudo rpm --import https://packages.microsoft.com/keys/microsoft.asc
sudo printf "[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc" > /tmp/vscode.repo
sudo mv /tmp/vscode.repo /etc/yum.repos.d/vscode.repo
sudo yum install -y code
sudo yum remove -y git*
sudo yum -y install https://centos7.iuscommunity.org/ius-release.rpm
sudo yum -y install git2u-all
%{ for addr in ip_addrs ~}
echo " ${addr}:${port} "
%{ endfor ~}
echo "This is the end my only friend. The end. Terraform!"